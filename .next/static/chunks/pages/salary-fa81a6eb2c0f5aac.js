(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{8681:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/salary",function(){return t(6154)}])},7435:function(e,a,t){"use strict";t.d(a,{Z:function(){return o}});var l=t(5893),s=t(1163),r=t(1664),i=t.n(r),n=t(5837);function o(e){let{children:a}=e;(0,s.useRouter)();let{user:t,loading:r,signOut:o}=(0,n.a)();return r?(0,l.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,l.jsx)("nav",{className:"bg-blue-600 text-white shadow-md",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between h-16",children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)(i(),{href:"/dashboard",className:"text-xl font-bold",children:"Salary & Leave Manager"})}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsx)(i(),{href:"/dashboard",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Dashboard"}),(0,l.jsx)(i(),{href:"/salary",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Salary"}),(0,l.jsx)(i(),{href:"/leave",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Annual Leave"}),(0,l.jsx)("span",{className:"px-3 py-2",children:null==t?void 0:t.email}),(0,l.jsx)("button",{onClick:o,className:"px-3 py-2 bg-red-600 hover:bg-red-700 rounded",children:"Sign Out"})]})]})})}),(0,l.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:a})]})}},6154:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var l=t(5893),s=t(7294),r=t(7435),i=t(8495),n=t(6822);let o=n.mM.create({page:{flexDirection:"column",backgroundColor:"#fff",padding:30},header:{marginBottom:20,padding:10,borderBottom:1,borderBottomColor:"#112246"},title:{fontSize:24,textAlign:"center",color:"#112246",marginBottom:10},subtitle:{fontSize:14,textAlign:"center",marginBottom:20},section:{margin:10,padding:10},row:{flexDirection:"row",justifyContent:"space-between",borderBottomWidth:1,borderBottomColor:"#eaeaea",paddingVertical:8},label:{fontSize:12},value:{fontSize:12,fontWeight:"bold"},totalRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:10,marginTop:10,borderTopWidth:2,borderTopColor:"#112246"},totalLabel:{fontSize:14,fontWeight:"bold"},totalValue:{fontSize:14,fontWeight:"bold",color:"#112246"},footer:{position:"absolute",bottom:30,left:30,right:30,textAlign:"center",fontSize:10,color:"grey"}});var c=e=>{let{salary:a,employee:t,month:s}=e,r=new Date(s+"-01"),i=r.toLocaleDateString("en-US",{month:"long",year:"numeric"});return(0,l.jsx)(n.BB,{children:(0,l.jsxs)(n.T3,{size:"A4",style:o.page,children:[(0,l.jsxs)(n.G7,{style:o.header,children:[(0,l.jsx)(n.xv,{style:o.title,children:"Salary Slip"}),(0,l.jsx)(n.xv,{style:o.subtitle,children:i})]}),(0,l.jsxs)(n.G7,{style:o.section,children:[(0,l.jsx)(n.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:"Employee Information"}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Name"}),(0,l.jsx)(n.xv,{style:o.value,children:t.name})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Employee ID"}),(0,l.jsx)(n.xv,{style:o.value,children:t.employee_id})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Position"}),(0,l.jsx)(n.xv,{style:o.value,children:t.position})]})]}),(0,l.jsxs)(n.G7,{style:o.section,children:[(0,l.jsx)(n.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:"Salary Components"}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Basic Salary (A)"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.basicSalary.toFixed(2)," EGP"]})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Cost of Living (B)"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.costOfLiving.toFixed(2)," EGP"]})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Shift Allowance (C)"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.shiftAllowance.toFixed(2)," EGP"]})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Overtime Hours"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.overtimeHours," hours"]})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Overtime Pay (D)"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.overtimePay.toFixed(2)," EGP"]})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"USD to EGP Exchange Rate"}),(0,l.jsx)(n.xv,{style:o.value,children:a.exchangeRate.toFixed(2)})]}),(0,l.jsxs)(n.G7,{style:o.row,children:[(0,l.jsx)(n.xv,{style:o.label,children:"Variable Pay (E)"}),(0,l.jsxs)(n.xv,{style:o.value,children:[a.variablePay.toFixed(2)," EGP"]})]}),(0,l.jsxs)(n.G7,{style:o.totalRow,children:[(0,l.jsx)(n.xv,{style:o.totalLabel,children:"Total Salary"}),(0,l.jsxs)(n.xv,{style:o.totalValue,children:[a.totalSalary.toFixed(2)," EGP"]})]})]}),(0,l.jsx)(n.G7,{style:o.footer,children:(0,l.jsxs)(n.xv,{children:["Generated on ",new Date().toLocaleDateString()]})})]})})};function d(){let[e,a]=(0,s.useState)(null),[t,o]=(0,s.useState)(!0),[d,x]=(0,s.useState)(!1),[h,m]=(0,s.useState)(null),[y,p]=(0,s.useState)(new Date().toISOString().substring(0,7)),[u,g]=(0,s.useState)([]),[v,b]=(0,s.useState)({basicSalary:0,costOfLiving:0,shiftAllowance:0,overtimeHours:0,overtimePay:0,variablePay:0,totalSalary:0,exchangeRate:0});(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/exchange-rate"),t=await e.json();t.exchangeRate&&m(t.exchangeRate);let{data:l}=await i.O.auth.getUser();if(l.user){let{data:e,error:t}=await i.O.from("employees").select("*").eq("id",l.user.id).single();if(t)throw t;a(e);let{data:s,error:r}=await i.O.from("salaries").select("*").eq("employee_id",l.user.id).order("month",{ascending:!1});if(r)throw r;g(s||[])}}catch(e){console.error("Error fetching data:",e)}finally{o(!1)}};e()},[]);let j=(e,a)=>{b(t=>({...t,[e]:a}))},f=async()=>{if(e&&h){x(!0);try{let a;let{data:t}=await i.O.from("salaries").select("id").eq("employee_id",e.id).eq("month","".concat(y,"-01")).single(),l={employee_id:e.id,month:"".concat(y,"-01"),basic_salary:v.basicSalary,cost_of_living:v.costOfLiving,shift_allowance:v.shiftAllowance,overtime_hours:v.overtimeHours,overtime_pay:v.overtimePay,variable_pay:v.variablePay,total_salary:v.totalSalary,exchange_rate:h};if((a=t?await i.O.from("salaries").update(l).eq("id",t.id):await i.O.from("salaries").insert(l)).error)throw a.error;let{data:s,error:r}=await i.O.from("salaries").select("*").eq("employee_id",e.id).order("month",{ascending:!1});if(r)throw r;g(s||[]),alert("Salary saved successfully!")}catch(e){console.error("Error saving salary:",e),alert("Failed to save salary. Please try again.")}finally{x(!1)}}};return t?(0,l.jsx)(r.Z,{children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading..."})}):(0,l.jsxs)(r.Z,{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Salary Calculator"}),(0,l.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Current Exchange Rate"}),(0,l.jsxs)("p",{className:"text-lg",children:["1 USD = ",(0,l.jsxs)("span",{className:"font-bold text-green-600",children:[h?h.toFixed(2):"..."," EGP"]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Calculate Salary"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Month"}),(0,l.jsx)("input",{type:"month",value:y,onChange:e=>p(e.target.value),className:"w-full p-2 border rounded"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Basic Salary (A)"}),(0,l.jsx)("input",{type:"number",value:v.basicSalary||"",onChange:e=>j("basicSalary",parseFloat(e.target.value)||0),className:"w-full p-2 border rounded",placeholder:"Enter basic salary"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Cost of Living (B)"}),(0,l.jsx)("input",{type:"number",value:v.costOfLiving||"",onChange:e=>j("costOfLiving",parseFloat(e.target.value)||0),className:"w-full p-2 border rounded",placeholder:"Enter cost of living"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Shift Allowance (C)"}),(0,l.jsx)("input",{type:"number",value:v.shiftAllowance||"",onChange:e=>j("shiftAllowance",parseFloat(e.target.value)||0),className:"w-full p-2 border rounded",placeholder:"Enter shift allowance"})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Overtime Hours"}),(0,l.jsx)("input",{type:"number",value:v.overtimeHours||"",onChange:e=>j("overtimeHours",parseFloat(e.target.value)||0),className:"w-full p-2 border rounded",placeholder:"Enter overtime hours"})]}),(0,l.jsx)("button",{onClick:()=>{if(!h)return;let{basicSalary:e,costOfLiving:a,shiftAllowance:t,overtimeHours:l}=v,s=(e+a)/210*l,r=(e+a+t+s)*(h/31-1);b({...v,overtimePay:s,variablePay:r,totalSalary:e+a+t+s+r,exchangeRate:h})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-2",disabled:!h,children:"Calculate"}),(0,l.jsx)("button",{onClick:f,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",disabled:!v.totalSalary||d,children:d?"Saving...":"Save Salary"})]}),(0,l.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Salary Results"}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("p",{className:"text-gray-600",children:"Overtime Pay (D)"}),(0,l.jsxs)("p",{className:"font-medium",children:[v.overtimePay.toFixed(2)," EGP"]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"((A+B)/210) * Overtime Hours"})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("p",{className:"text-gray-600",children:"Variable Pay (E)"}),(0,l.jsxs)("p",{className:"font-medium",children:[v.variablePay.toFixed(2)," EGP"]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"((A+B+C+D) * ((exchange rate/31) - 1))"})]}),(0,l.jsxs)("div",{className:"mt-6 pt-4 border-t",children:[(0,l.jsx)("p",{className:"text-gray-600 text-lg",children:"Total Salary"}),(0,l.jsxs)("p",{className:"font-bold text-2xl text-green-600",children:[v.totalSalary.toFixed(2)," EGP"]}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:"A + B + C + D + E"})]}),v.totalSalary>0&&e&&(0,l.jsx)("div",{className:"mt-6",children:(0,l.jsx)(n.z6,{document:(0,l.jsx)(c,{salary:v,employee:e,month:y}),children:a=>{let{blob:t,url:s,loading:r,error:i}=a;return(0,l.jsx)("a",{href:s||void 0,download:"salary-slip-".concat(y,"-").concat(e.name,".pdf"),className:"inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:r?"Generating PDF...":"Download PDF"})}})})]})]}),(0,l.jsxs)("div",{className:"mt-8 bg-white shadow rounded-lg p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Salary History"}),u.length>0?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Basic Salary"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost of Living"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shift Allowance"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Overtime Pay"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variable Pay"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Salary"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:u.map(a=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(a.month).toLocaleDateString("en-US",{month:"long",year:"numeric"})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.basic_salary.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.cost_of_living.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.shift_allowance.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.overtime_pay.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:a.variable_pay.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-bold",children:a.total_salary.toFixed(2)}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsx)(n.z6,{document:(0,l.jsx)(c,{salary:{basicSalary:a.basic_salary,costOfLiving:a.cost_of_living,shiftAllowance:a.shift_allowance,overtimeHours:a.overtime_hours,overtimePay:a.overtime_pay,variablePay:a.variable_pay,totalSalary:a.total_salary,exchangeRate:a.exchange_rate},employee:e,month:new Date(a.month).toISOString().substring(0,7)}),children:t=>{let{blob:s,url:r,loading:i,error:n}=t;return(0,l.jsx)("a",{href:r||void 0,download:"salary-".concat(new Date(a.month).toISOString().substring(0,7),"-").concat(null==e?void 0:e.name,".pdf"),className:"text-red-600 hover:text-red-800",children:i?"Loading...":"Download PDF"})}})})]},a.id))})]})}):(0,l.jsx)("p",{children:"No salary history available."})]})]})}},2480:function(){}},function(e){e.O(0,[439,111,191,664,10,774,888,179],function(){return e(e.s=8681)}),_N_E=e.O()}]);
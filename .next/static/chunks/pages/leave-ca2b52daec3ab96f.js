(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{605:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leave",function(){return l(2470)}])},7435:function(e,a,l){"use strict";l.d(a,{Z:function(){return d}});var s=l(5893),t=l(1163),r=l(1664),n=l.n(r),i=l(5837);function d(e){let{children:a}=e;(0,t.useRouter)();const{user:l,loading:r,signOut:d}=(0,i.a)();return r?(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("nav",{className:"bg-blue-600 text-white shadow-md",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(n(),{href:"/dashboard",className:"text-xl font-bold",children:"Salary & Leave Manager"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(n(),{href:"/dashboard",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Dashboard"}),(0,s.jsx)(n(),{href:"/salary",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Salary"}),(0,s.jsx)(n(),{href:"/leave",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Annual Leave"}),(0,s.jsx)("span",{className:"px-3 py-2",children:null===l||void 0===l?void 0:l.email}),(0,s.jsx)("button",{onClick:d,className:"px-3 py-2 bg-red-600 hover:bg-red-700 rounded",children:"Sign Out"})]})]})})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:a})]})}},2470:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return c}});var s=l(5893),t=l(7294),r=l(7435),n=l(8495),i=l(6822);const d=i.mM.create({page:{flexDirection:"column",backgroundColor:"#fff",padding:30},title:{fontSize:24,textAlign:"center",marginBottom:30,color:"#112246"},section:{margin:10,padding:10},table:{display:"flex",width:"auto",borderStyle:"solid",borderWidth:1,borderColor:"#bfbfbf",marginBottom:20},tableRow:{flexDirection:"row"},tableColHeader:{width:"33%",borderStyle:"solid",borderColor:"#bfbfbf",borderBottomWidth:1,borderRightWidth:1,padding:5,backgroundColor:"#f2f2f2"},tableCol:{width:"33%",borderStyle:"solid",borderColor:"#bfbfbf",borderRightWidth:1,padding:5},tableHeader:{fontSize:12,fontWeight:"bold"},tableCell:{fontSize:10,margin:4},summaryContainer:{marginTop:20,borderTop:1,borderTopColor:"#112246",paddingTop:10},summaryRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:10},summaryLabel:{fontSize:12,fontWeight:"bold"},summaryValue:{fontSize:12},footer:{position:"absolute",bottom:30,left:30,right:30,textAlign:"center",fontSize:10,color:"grey"}}),o=e=>{let{employee:a,leaveData:l,totalLeaveBalance:t,leaveTaken:r,remainingLeave:n,year:o}=e;return(0,s.jsx)(i.BB,{children:(0,s.jsxs)(i.T3,{size:"A4",style:d.page,children:[(0,s.jsx)(i.xv,{style:d.title,children:"Annual Leave Report"}),(0,s.jsxs)(i.G7,{style:d.section,children:[(0,s.jsx)(i.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:"Employee Information"}),(0,s.jsxs)(i.G7,{style:d.table,children:[(0,s.jsxs)(i.G7,{style:d.tableRow,children:[(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Name"})}),(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Employee ID"})}),(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Position"})})]}),(0,s.jsxs)(i.G7,{style:d.tableRow,children:[(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:a.name})}),(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:a.employee_id})}),(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:a.position})})]})]})]}),(0,s.jsxs)(i.G7,{style:d.section,children:[(0,s.jsxs)(i.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:["Leave Details for ",o]}),(0,s.jsxs)(i.G7,{style:d.table,children:[(0,s.jsxs)(i.G7,{style:d.tableRow,children:[(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Month"})}),(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Days Taken"})}),(0,s.jsx)(i.G7,{style:d.tableColHeader,children:(0,s.jsx)(i.xv,{style:d.tableHeader,children:"Date Recorded"})})]}),l.map((e=>(0,s.jsxs)(i.G7,{style:d.tableRow,children:[(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:new Date(e.year,e.month-1,1).toLocaleString("default",{month:"long"})})}),(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:e.days_taken})}),(0,s.jsx)(i.G7,{style:d.tableCol,children:(0,s.jsx)(i.xv,{style:d.tableCell,children:new Date(e.created_at).toLocaleDateString()})})]},e.id)))]})]}),(0,s.jsxs)(i.G7,{style:d.summaryContainer,children:[(0,s.jsxs)(i.G7,{style:d.summaryRow,children:[(0,s.jsx)(i.xv,{style:d.summaryLabel,children:"Total Annual Leave Entitlement"}),(0,s.jsxs)(i.xv,{style:d.summaryValue,children:[t," days"]})]}),(0,s.jsxs)(i.G7,{style:d.summaryRow,children:[(0,s.jsx)(i.xv,{style:d.summaryLabel,children:"Leave Taken"}),(0,s.jsxs)(i.xv,{style:d.summaryValue,children:[r," days"]})]}),(0,s.jsxs)(i.G7,{style:d.summaryRow,children:[(0,s.jsx)(i.xv,{style:d.summaryLabel,children:"Remaining Leave"}),(0,s.jsxs)(i.xv,{style:d.summaryValue,children:[n," days"]})]})]}),(0,s.jsx)(i.G7,{style:d.footer,children:(0,s.jsxs)(i.xv,{children:["Generated on ",(new Date).toLocaleDateString()]})})]})})};function c(){const[e,a]=(0,t.useState)(null),[l,d]=(0,t.useState)(!0),[c,x]=(0,t.useState)((new Date).getFullYear()),[h,m]=(0,t.useState)((new Date).getMonth()+1),[y,u]=(0,t.useState)(null),[b,g]=(0,t.useState)(!1),[j,p]=(0,t.useState)([]),[f,v]=(0,t.useState)(0),[w,N]=(0,t.useState)(0),[C,S]=(0,t.useState)(0);(0,t.useEffect)((()=>{L()}),[]),(0,t.useEffect)((()=>{e&&D()}),[e,c]);const L=async()=>{try{const{data:e}=await n.O.auth.getUser();if(!e.user)return;const{data:l,error:s}=await n.O.from("employees").select("*").eq("email",e.user.email).single();if(s)throw s;a(l);const t=l.years_of_service>=10?24.67:18.67;v(t),d(!1)}catch(e){console.error("Error fetching employee data:",e),d(!1)}},D=async()=>{try{const{data:a,error:l}=await n.O.from("leaves").select("*").eq("employee_id",e.id).eq("year",c).order("month",{ascending:!0});if(l)throw l;p(a||[]);const s=a?a.reduce(((e,a)=>e+a.days_taken),0):0;N(s),S(f-s)}catch(a){console.error("Error fetching leave data:",a)}};return l?(0,s.jsx)(r.Z,{children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading..."})}):(0,s.jsxs)(r.Z,{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Annual Leave Management"}),e&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Leave Balance"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Total Annual Leave"}),(0,s.jsxs)("p",{className:"font-medium text-xl",children:[f," days"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.years_of_service>=10?"Based on 10+ years of service":"Standard allocation"})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Leave Taken"}),(0,s.jsxs)("p",{className:"font-medium text-xl",children:[w," days"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["In ",c]})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Remaining Leave"}),(0,s.jsxs)("p",{className:"font-medium text-xl text-blue-600",children:[C.toFixed(2)," days"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"As of today"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Record Leave"}),(0,s.jsxs)("form",{onSubmit:async a=>{if(a.preventDefault(),e&&y){g(!0);try{const{data:a,error:l}=await n.O.from("leaves").select("*").eq("employee_id",e.id).eq("year",c).eq("month",h).maybeSingle();if(l)throw l;if(a){const{error:e}=await n.O.from("leaves").update({days_taken:y}).eq("id",a.id);if(e)throw e}else{const{error:a}=await n.O.from("leaves").insert({employee_id:e.id,year:c,month:h,days_taken:y});if(a)throw a}await D(),u(null)}catch(l){console.error("Error saving leave:",l)}finally{g(!1)}}},children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Year"}),(0,s.jsx)("select",{value:c,onChange:e=>x(parseInt(e.target.value)),className:"w-full p-2 border rounded",children:Array.from({length:5},((e,a)=>(new Date).getFullYear()-2+a)).map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Month"}),(0,s.jsx)("select",{value:h,onChange:e=>m(parseInt(e.target.value)),className:"w-full p-2 border rounded",children:Array.from({length:12},((e,a)=>a+1)).map((e=>(0,s.jsx)("option",{value:e,children:new Date(2e3,e-1,1).toLocaleString("default",{month:"long"})},e)))})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Days Taken"}),(0,s.jsx)("input",{type:"number",value:y||"",onChange:e=>u(parseFloat(e.target.value)||0),step:"0.5",min:"0",className:"w-full p-2 border rounded",placeholder:"Enter days taken"})]}),(0,s.jsx)("button",{type:"submit",disabled:b||null===y||y<=0,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-blue-300",children:b?"Saving...":"Save Leave"})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Leave History"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Year:"}),(0,s.jsx)("select",{value:c,onChange:e=>{return a=parseInt(e.target.value),void x(a);var a},className:"p-1 border rounded",children:Array.from({length:5},((e,a)=>(new Date).getFullYear()-2+a)).map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]})]}),j.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Taken"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Recorded"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map((e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.year,e.month-1,1).toLocaleString("default",{month:"long"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.days_taken}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.created_at).toLocaleDateString()})]},e.id)))})]})}):(0,s.jsxs)("p",{className:"text-gray-500",children:["No leave records found for ",c,"."]}),e&&j.length>0&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(i.z6,{document:(0,s.jsx)(o,{employee:e,leaveData:j,totalLeaveBalance:f,leaveTaken:w,remainingLeave:C,year:c}),children:a=>{let{blob:l,url:t,loading:r,error:n}=a;return(0,s.jsx)("a",{href:t||void 0,download:"leave-report-".concat(c,"-").concat(e.name,".pdf"),className:"inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:r?"Generating PDF...":"Download PDF Report"})}})})]})]})]})}},2480:function(){}},function(e){e.O(0,[439,111,191,664,10,774,888,179],(function(){return a=605,e(e.s=a);var a}));var a=e.O();_N_E=a}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{605:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leave",function(){return a(2470)}])},7435:function(e,l,a){"use strict";a.d(l,{Z:function(){return i}});var s=a(5893),t=a(1163),r=a(1664),n=a.n(r),d=a(5837);function i(e){let{children:l}=e;(0,t.useRouter)();let{user:a,loading:r,signOut:i}=(0,d.a)();return r?(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("nav",{className:"bg-blue-600 text-white shadow-md",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(n(),{href:"/dashboard",className:"text-xl font-bold",children:"Salary & Leave Manager"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(n(),{href:"/dashboard",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Dashboard"}),(0,s.jsx)(n(),{href:"/salary",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Salary"}),(0,s.jsx)(n(),{href:"/leave",className:"px-3 py-2 hover:bg-blue-700 rounded",children:"Annual Leave"}),(0,s.jsx)("span",{className:"px-3 py-2",children:null==a?void 0:a.email}),(0,s.jsx)("button",{onClick:i,className:"px-3 py-2 bg-red-600 hover:bg-red-700 rounded",children:"Sign Out"})]})]})})}),(0,s.jsx)("main",{className:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8",children:l})]})}},2470:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return c}});var s=a(5893),t=a(7294),r=a(7435),n=a(8495),d=a(6822);let i=d.mM.create({page:{flexDirection:"column",backgroundColor:"#fff",padding:30},title:{fontSize:24,textAlign:"center",marginBottom:30,color:"#112246"},section:{margin:10,padding:10},table:{display:"flex",width:"auto",borderStyle:"solid",borderWidth:1,borderColor:"#bfbfbf",marginBottom:20},tableRow:{flexDirection:"row"},tableColHeader:{width:"33%",borderStyle:"solid",borderColor:"#bfbfbf",borderBottomWidth:1,borderRightWidth:1,padding:5,backgroundColor:"#f2f2f2"},tableCol:{width:"33%",borderStyle:"solid",borderColor:"#bfbfbf",borderRightWidth:1,padding:5},tableHeader:{fontSize:12,fontWeight:"bold"},tableCell:{fontSize:10,margin:4},summaryContainer:{marginTop:20,borderTop:1,borderTopColor:"#112246",paddingTop:10},summaryRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:10},summaryLabel:{fontSize:12,fontWeight:"bold"},summaryValue:{fontSize:12},footer:{position:"absolute",bottom:30,left:30,right:30,textAlign:"center",fontSize:10,color:"grey"}}),o=e=>{let{employee:l,leaveData:a,totalLeaveBalance:t,leaveTaken:r,remainingLeave:n,year:o}=e;return(0,s.jsx)(d.BB,{children:(0,s.jsxs)(d.T3,{size:"A4",style:i.page,children:[(0,s.jsx)(d.xv,{style:i.title,children:"Annual Leave Report"}),(0,s.jsxs)(d.G7,{style:i.section,children:[(0,s.jsx)(d.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:"Employee Information"}),(0,s.jsxs)(d.G7,{style:i.table,children:[(0,s.jsxs)(d.G7,{style:i.tableRow,children:[(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Name"})}),(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Employee ID"})}),(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Position"})})]}),(0,s.jsxs)(d.G7,{style:i.tableRow,children:[(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:l.name})}),(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:l.employee_id})}),(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:l.position})})]})]})]}),(0,s.jsxs)(d.G7,{style:i.section,children:[(0,s.jsxs)(d.xv,{style:{fontSize:16,marginBottom:10,fontWeight:"bold"},children:["Leave Details for ",o]}),(0,s.jsxs)(d.G7,{style:i.table,children:[(0,s.jsxs)(d.G7,{style:i.tableRow,children:[(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Month"})}),(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Days Taken"})}),(0,s.jsx)(d.G7,{style:i.tableColHeader,children:(0,s.jsx)(d.xv,{style:i.tableHeader,children:"Date Recorded"})})]}),a.map(e=>(0,s.jsxs)(d.G7,{style:i.tableRow,children:[(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:new Date(e.year,e.month-1,1).toLocaleString("default",{month:"long"})})}),(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:e.days_taken})}),(0,s.jsx)(d.G7,{style:i.tableCol,children:(0,s.jsx)(d.xv,{style:i.tableCell,children:new Date(e.created_at).toLocaleDateString()})})]},e.id))]})]}),(0,s.jsxs)(d.G7,{style:i.summaryContainer,children:[(0,s.jsxs)(d.G7,{style:i.summaryRow,children:[(0,s.jsx)(d.xv,{style:i.summaryLabel,children:"Total Annual Leave Entitlement"}),(0,s.jsxs)(d.xv,{style:i.summaryValue,children:[t," days"]})]}),(0,s.jsxs)(d.G7,{style:i.summaryRow,children:[(0,s.jsx)(d.xv,{style:i.summaryLabel,children:"Leave Taken"}),(0,s.jsxs)(d.xv,{style:i.summaryValue,children:[r," days"]})]}),(0,s.jsxs)(d.G7,{style:i.summaryRow,children:[(0,s.jsx)(d.xv,{style:i.summaryLabel,children:"Remaining Leave"}),(0,s.jsxs)(d.xv,{style:i.summaryValue,children:[n," days"]})]})]}),(0,s.jsx)(d.G7,{style:i.footer,children:(0,s.jsxs)(d.xv,{children:["Generated on ",new Date().toLocaleDateString()]})})]})})};function c(){let[e,l]=(0,t.useState)(null),[a,i]=(0,t.useState)(!0),[c,x]=(0,t.useState)(new Date().getFullYear()),[h,m]=(0,t.useState)(new Date().getMonth()+1),[y,u]=(0,t.useState)(null),[b,j]=(0,t.useState)(!1),[g,p]=(0,t.useState)([]),[f,v]=(0,t.useState)(0),[w,N]=(0,t.useState)(0),[C,S]=(0,t.useState)(0);(0,t.useEffect)(()=>{D()},[]),(0,t.useEffect)(()=>{e&&L()},[e,c]);let D=async()=>{try{let{data:e}=await n.O.auth.getUser();if(!e.user)return;let{data:a,error:s}=await n.O.from("employees").select("*").eq("email",e.user.email).single();if(s)throw s;l(a);let t=a.years_of_service>=10?24.67:18.67;v(t),i(!1)}catch(e){console.error("Error fetching employee data:",e),i(!1)}},L=async()=>{try{let{data:l,error:a}=await n.O.from("leaves").select("*").eq("employee_id",e.id).eq("year",c).order("month",{ascending:!0});if(a)throw a;p(l||[]);let s=l?l.reduce((e,l)=>e+l.days_taken,0):0;N(s),S(f-s)}catch(e){console.error("Error fetching leave data:",e)}},G=async l=>{if(l.preventDefault(),e&&y){j(!0);try{let{data:l,error:a}=await n.O.from("leaves").select("*").eq("employee_id",e.id).eq("year",c).eq("month",h).maybeSingle();if(a)throw a;if(l){let{error:e}=await n.O.from("leaves").update({days_taken:y}).eq("id",l.id);if(e)throw e}else{let{error:l}=await n.O.from("leaves").insert({employee_id:e.id,year:c,month:h,days_taken:y});if(l)throw l}await L(),u(null)}catch(e){console.error("Error saving leave:",e)}finally{j(!1)}}},_=e=>{x(e)};return a?(0,s.jsx)(r.Z,{children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:"Loading..."})}):(0,s.jsxs)(r.Z,{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Annual Leave Management"}),e&&(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Leave Balance"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Total Annual Leave"}),(0,s.jsxs)("p",{className:"font-medium text-xl",children:[f," days"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.years_of_service>=10?"Based on 10+ years of service":"Standard allocation"})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Leave Taken"}),(0,s.jsxs)("p",{className:"font-medium text-xl",children:[w," days"]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["In ",c]})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-50 rounded",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Remaining Leave"}),(0,s.jsxs)("p",{className:"font-medium text-xl text-blue-600",children:[C.toFixed(2)," days"]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"As of today"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Record Leave"}),(0,s.jsxs)("form",{onSubmit:G,children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Year"}),(0,s.jsx)("select",{value:c,onChange:e=>x(parseInt(e.target.value)),className:"w-full p-2 border rounded",children:Array.from({length:5},(e,l)=>new Date().getFullYear()-2+l).map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Month"}),(0,s.jsx)("select",{value:h,onChange:e=>m(parseInt(e.target.value)),className:"w-full p-2 border rounded",children:Array.from({length:12},(e,l)=>l+1).map(e=>(0,s.jsx)("option",{value:e,children:new Date(2e3,e-1,1).toLocaleString("default",{month:"long"})},e))})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block mb-1",children:"Days Taken"}),(0,s.jsx)("input",{type:"number",value:y||"",onChange:e=>u(parseFloat(e.target.value)||0),step:"0.5",min:"0",className:"w-full p-2 border rounded",placeholder:"Enter days taken"})]}),(0,s.jsx)("button",{type:"submit",disabled:b||null===y||y<=0,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-blue-300",children:b?"Saving...":"Save Leave"})]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Leave History"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Year:"}),(0,s.jsx)("select",{value:c,onChange:e=>_(parseInt(e.target.value)),className:"p-1 border rounded",children:Array.from({length:5},(e,l)=>new Date().getFullYear()-2+l).map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]})]}),g.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Taken"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Recorded"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.year,e.month-1,1).toLocaleString("default",{month:"long"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.days_taken}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]})}):(0,s.jsxs)("p",{className:"text-gray-500",children:["No leave records found for ",c,"."]}),e&&g.length>0&&(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(d.z6,{document:(0,s.jsx)(o,{employee:e,leaveData:g,totalLeaveBalance:f,leaveTaken:w,remainingLeave:C,year:c}),children:l=>{let{blob:a,url:t,loading:r,error:n}=l;return(0,s.jsx)("a",{href:t||void 0,download:"leave-report-".concat(c,"-").concat(e.name,".pdf"),className:"inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:r?"Generating PDF...":"Download PDF Report"})}})})]})]})]})}},2480:function(){}},function(e){e.O(0,[439,111,191,664,10,774,888,179],function(){return e(e.s=605)}),_N_E=e.O()}]);